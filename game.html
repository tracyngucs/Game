<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Appointed Time</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
  body {
    font-family: sans-serif;
    margin: 0;
    background: white;
  }

  /* HOME SCREEN */
  #homeScreen {
    text-align: center;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    height: 100vh;
  }

  #homeScreen input {
    padding: 12px;
    font-size: 20px;
    width: 280px;
    margin-bottom: 15px;
    border-radius: 8px;
    border: 1px solid #aaa;
  }

  #startButton {
    padding: 14px 30px;
    font-size: 22px;
    background: #0077cc;
    color: white;
    border: none;
    border-radius: 10px;
    cursor: pointer;
  }

  /* GAME SCREEN */
  #gameScreen, #endScreen {
    display: none;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    padding: 20px;
  }

  #playerInfo {
    font-size: 22px;
    margin-bottom: 20px;
  }

  #timerButton {
    width: 300px;
    height: 300px;
    border-radius: 150px;
    background: linear-gradient(to bottom, #ff4d4d, #b30000);
    color: white;
    font-size: 48px;
    border: none;
    cursor: pointer;
    box-shadow: 0 10px 20px rgba(0,0,0,0.4), 0 4px 6px rgba(0,0,0,0.2);
    transition: transform 0.1s, box-shadow 0.1s;
  }

  #timerButton:active {
    transform: translateY(4px);
    box-shadow: 0 4px 6px rgba(0,0,0,0.4);
  }

  #timeDisplay {
    margin-top: 20px;
    font-size: 36px;
  }

  #triesDisplay {
    margin-top: 10px;
    font-size: 24px;
  }

  #message {
    margin-top: 10px;
    font-size: 22px;
    color: #333;
  }

  #endSummaryBox {
    margin-top: 20px;
    width: 90%;
    max-width: 400px;
    max-height: 250px;
    overflow-y: auto;
    border: 2px solid #444;
    border-radius: 10px;
    padding: 10px;
    font-size: 18px;
    background: #f7f7f7;
    text-align: left;
  }

  #playerChoiceEnd {
    margin-top: 20px;
  }

  #playerChoiceEnd button {
    margin: 0 10px;
    padding: 10px 20px;
    font-size: 18px;
    border-radius: 8px;
    border: none;
    cursor: pointer;
    background: #0077cc;
    color: white;
  }

  #playerChoiceEnd button:hover {
    background: #005fa3;
  }
</style>
</head>
<body>

<!-- HOME SCREEN -->
<div id="homeScreen">
  <h1>Appointed Time</h1>
  <input type="text" id="playerName" placeholder="Enter Name" /><br>
  <input type="tel" id="playerMobile" placeholder="Enter Mobile Number" /><br>
  <button id="startButton">Start Now</button>
</div>

<!-- GAME SCREEN -->
<div id="gameScreen">
  <div id="playerInfo"></div>
  <button id="timerButton">Start</button>
  <div id="timeDisplay">0.000 s</div>
  <div id="triesDisplay">Tries: 0 / 10</div>
  <div id="message"></div>
</div>

<!-- END SCREEN -->
<div id="endScreen">
  <div id="endPlayerInfo"></div>
  <div id="endMessage"></div>
  <div id="endSummaryBox"></div>
  <div id="playerChoiceEnd">
    <span>Play as:</span>
    <button id="samePlayerBtnEnd">Same Player</button>
    <button id="nextPlayerBtnEnd">Next Player</button>
  </div>
</div>

<script>
let running = false;
let startTime = 0;
let tries = 0;
let currentResults = [];
let allResults = []; // accumulate all 10-round sessions

let playerNameValue = "";
let playerMobileValue = "";

const homeScreen = document.getElementById('homeScreen');
const gameScreen = document.getElementById('gameScreen');
const endScreen = document.getElementById('endScreen');

const playerInfo = document.getElementById('playerInfo');
const timerButton = document.getElementById('timerButton');
const display = document.getElementById('timeDisplay');
const triesDisplay = document.getElementById('triesDisplay');
const message = document.getElementById('message');

const endPlayerInfo = document.getElementById('endPlayerInfo');
const endMessage = document.getElementById('endMessage');
const endSummaryBox = document.getElementById('endSummaryBox');
const playerChoiceEnd = document.getElementById('playerChoiceEnd');
const samePlayerBtnEnd = document.getElementById('samePlayerBtnEnd');
const nextPlayerBtnEnd = document.getElementById('nextPlayerBtnEnd');

const startButton = document.getElementById('startButton');

startButton.addEventListener("click", () => {
  playerNameValue = document.getElementById("playerName").value.trim();
  playerMobileValue = document.getElementById("playerMobile").value.trim();
  if (!playerNameValue || !playerMobileValue) { alert("Please enter both name and mobile number."); return; }
  playerInfo.textContent = `Player: ${playerNameValue}`;
  homeScreen.style.display = "none";
  gameScreen.style.display = "flex";
  tries = 0;
  display.textContent = "0.000 s";
  triesDisplay.textContent = "Tries: 0 / 10";
  message.textContent = "";
  currentResults = [];
});

timerButton.addEventListener("click", () => {
  if (tries >= 10 && timerButton.textContent === "Reset") {
    // Move to end screen and save session results
    allResults.push([...currentResults]);
    currentResults = [];
    gameScreen.style.display = "none";
    endScreen.style.display = "flex";
    endPlayerInfo.textContent = `Player: ${playerNameValue}`;
    endMessage.textContent = "Thanks for playing!";
    showEndSummary();
    return;
  }

  if (tries >= 10) return;

  if (!running) {
    running = true;
    startTime = performance.now();
    display.textContent = "0.000 s";
    timerButton.textContent = "Stop";
    document.body.style.backgroundColor = "white";
    requestAnimationFrame(updateTimer);
  } else {
    running = false;
    tries++;
    const elapsed = (performance.now() - startTime) / 1000;
    const formatted = elapsed.toFixed(3);
    currentResults.push(parseFloat(formatted));
    display.textContent = formatted + " s";
    triesDisplay.textContent = "Tries: " + tries + " / 10";
    document.body.style.backgroundColor = (formatted === "3.000") ? "green" : "red";
    timerButton.textContent = (formatted === "3.000") ? "You Win!" : "Try Again";
    if (tries >= 10) {
      timerButton.textContent = "Reset";
      message.textContent = "Thanks for playing!";
    }
  }
});

function updateTimer() {
  if (running) {
    const elapsed = (performance.now() - startTime) / 1000;
    display.textContent = elapsed.toFixed(3) + " s";
    requestAnimationFrame(updateTimer);
  }
}

function showEndSummary() {
  endSummaryBox.innerHTML = "";
  allResults.forEach((session, sIndex) => {
    let best = session.reduce((a,b)=>Math.abs(a-3)<Math.abs(b-3)?a:b);
    let list = "";
    session.forEach((t,i)=>list += `Try ${i+1}: ${t.toFixed(3)}s / 3.000s<br>`);
    endSummaryBox.innerHTML += `<b>Session ${sIndex+1}</b><br>${list}<b>Best Time:</b> ${best.toFixed(3)}s / 3.000s<br><br>`;
  });
}

// SAME PLAYER → start new 10-round session
samePlayerBtnEnd.addEventListener("click", () => {
  endScreen.style.display = "none";
  gameScreen.style.display = "flex";
  tries = 0;
  display.textContent = "0.000 s";
  triesDisplay.textContent = "Tries: 0 / 10";
  message.textContent = "";
  currentResults = [];
  document.body.style.backgroundColor = "white";
  timerButton.textContent = "Start";
});

// NEXT PLAYER → reset everything
nextPlayerBtnEnd.addEventListener("click", () => {
  endScreen.style.display = "none";
  homeScreen.style.display = "flex";
  results = [];
  currentResults = [];
  allResults = [];
  tries = 0;
  document.getElementById("playerName").value = "";
  document.getElementById("playerMobile").value = "";
});
</script>
</body>
</html>
